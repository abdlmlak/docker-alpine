#!/usr/bin/env bash

function usage {
    echo -e "Usage: $(basename "$0") <PID_FILE> <COMMAND>"
    echo -e ""
    echo -e "Execute a daemon process and waits the end of his execution."
    echo -e ""
    echo -e "Options:"
    echo -e "  --help\t\t\tdisplay this help and exit"
}

pidfile="$1"
shift
command=$@

function cleanup() {
    trap - ERR INT TERM

    kill $(cat $pidfile)
}

trap 'cleanup; exit 1' ERR INT TERM

$command

while [ -f "$pidfile" ] && kill -0 $(cat "$pidfile") ; do
    sleep 4
done

exit 0
